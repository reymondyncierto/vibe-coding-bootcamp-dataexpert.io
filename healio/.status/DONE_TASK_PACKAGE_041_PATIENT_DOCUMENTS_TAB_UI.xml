<?xml version='1.0' encoding='utf-8'?>
<task_packages>
    <task_package>
        <metadata>
            <id>HEALIO-041</id>
            <title>Build Patient Documents Tab UI (Upload/List/Preview)</title>
            <domain>Patient Records Frontend</domain>
            <estimated_time>45 mins</estimated_time>
            <priority>medium</priority>
            <status>DONE</status>
            <is_done>true</is_done>
            <verification_status>PASSED</verification_status>
            <dependencies>HEALIO-006, HEALIO-037, HEALIO-039</dependencies>
            <prd_reference>Feature 3 Documents Tab</prd_reference>
        </metadata>
        <context>
            <background>This task implements Build Patient Documents Tab UI (Upload/List/Preview) for Healio and is scoped as one atomic work item aligned to the PRD. It should be completed within 45 mins and leave clear evidence for follow-on tasks.</background>
            <files_involved>
                <file>healio/components/patients/patient-documents-tab.tsx</file>
                <file>healio/components/patients/document-upload-drawer.tsx</file>
                <file>healio/hooks/usePatientDocuments.ts</file>
            </files_involved>
            <related_api_endpoints>
                <endpoint>GET /api/v1/patients/:id/documents</endpoint>
                <endpoint>POST /api/v1/patients/:id/documents</endpoint>
            </related_api_endpoints>
            <design_constraints>
                <constraint>Use Stripe-like frictionless workflows: create/edit actions should open centered modals or slide-out drawers instead of disruptive full-page forms.</constraint>
                <constraint>Use a Viedoc-style bento layout: soft floating white cards on an off-white background for dashboards and dense data views.</constraint>
                <constraint>Apply the Paper Replacement palette: app background near #F9FAFB, white cards, calm trustworthy accents (teal/sage/cerulean), and reserve red for critical alerts only.</constraint>
                <constraint>Preserve high-legibility typography: clean sans-serif (Inter/SF Pro/Halyard), bold patient names, slate-gray secondary metadata.</constraint>
                <constraint>Honor the one-click rule where applicable: keep the global + action for Add Appointment, Add Patient, and Create Invoice visible and easy to reach.</constraint>
                <constraint>Add educational empty states with clear CTAs for first-time or empty datasets.</constraint>
            </design_constraints>
        </context>
        <instruction>
            <step>Implement the scoped changes for Build Patient Documents Tab UI (Upload/List/Preview) in the planned files (healio/components/patients/patient-documents-tab.tsx, healio/components/patients/document-upload-drawer.tsx, healio/hooks/usePatientDocuments.ts) while preserving the PRD-aligned project structure.</step>
            <step>Apply validation, error handling, and consistent response/UI behavior so the task output integrates cleanly with existing helpers and patterns.</step>
            <step>Wire integrations and dependencies for this task (endpoints: GET /api/v1/patients/:id/documents, POST /api/v1/patients/:id/documents) and keep tenant scoping/RBAC/security expectations intact where applicable.</step>
            <step>Prefer in-context modal/drawer workflows, scannable bento cards, and educational empty states so the UI matches the requested Healio experience.</step>
            <step>Verify keyboard/focus behavior, touch target sizing, and mobile responsiveness before marking the task ready.</step>
            <validation_checklist>
                <check>Exercise the related endpoint(s): GET /api/v1/patients/:id/documents, POST /api/v1/patients/:id/documents and verify response shape/status codes.</check>
                <check>Run lint/typecheck or the smallest relevant test suite for the files changed by this task.</check>
                <check>Manually verify desktop and mobile layouts plus focus/keyboard behavior for the primary interaction path.</check>
                <check>Use Chrome DevTools MCP to verify the implemented UI in-browser (desktop + mobile), check interactions, inspect console errors, and capture a validation snapshot before marking done.</check><check>Capture a screenshot or short note confirming empty/loading/error states are present where applicable.</check>
            </validation_checklist>
        </instruction>
        <output_spec>
            <artifacts>
                <artifact>Next.js page/component updates</artifact>
                <artifact>Route handler/API contract updates</artifact>
            </artifacts>
            <acceptance_criteria>
                <criterion>The deliverable for Build Patient Documents Tab UI (Upload/List/Preview) is implemented in the referenced files and compiles without breaking adjacent modules.</criterion>
                <criterion>Task output matches the PRD scope (Feature 3 Documents Tab) and remains bounded to an atomic &lt;=45-minute implementation chunk.</criterion>
                <criterion>Related endpoint behavior returns the standard success/error envelope and respects auth/public route expectations for the route class.</criterion>
                <criterion>UI states (loading, empty, error, success) are present and visually consistent with Healio bento cards, off-white background, and trust-oriented styling.</criterion>
                <criterion>Interactions are keyboard accessible and usable on mobile without disruptive navigation when a modal/drawer workflow is appropriate.</criterion>
            </acceptance_criteria>
            <commit_message>feat(healio-patients): patient documents tab ui</commit_message>
        </output_spec>
        <execution_tracking>
            <state>DONE</state>
            <is_done>true</is_done>
            <owner>patient-records-lite-emr</owner>
            <started_at>2026-02-24T18:37:05+08:00</started_at>
            <completed_at>2026-02-24T18:37:05+08:00</completed_at>
            <verification_status>PASSED</verification_status>
            <verification_command>npm run typecheck; node --import tsx --test tests/unit/patient-documents-route.test.ts; Chrome DevTools MCP on http://localhost:4012/patients/:id (documents tab upload/list/preview)</verification_command>
            <verification_notes>Implemented the patient chart Documents tab with a Stripe-style upload drawer, bento-style document list, and in-context preview modal. Preview gracefully falls back to a metadata + signed URL message in local memory storage mode (`memory://signed/...`) while still supporting real HTTP/Supabase signed URL inline previews later. Chrome DevTools MCP verification covered empty state, upload flow, preview modal, keyboard dismissal, responsive layout, and console/network checks.</verification_notes>
            <evidence>
                <item>When work starts/completes, record changed files, test commands, screenshots (UI tasks), and commit/PR references here.</item>
                <item>Include Chrome DevTools MCP evidence (snapshot/screenshot reference and notes on responsive + interaction checks) here before marking frontend tasks complete.</item>
                <item>Changed files: healio/components/patients/patient-documents-tab.tsx, healio/components/patients/document-upload-drawer.tsx, healio/hooks/usePatientDocuments.ts, healio/app/(dashboard)/patients/[id]/page.tsx, healio/components/patients/patient-profile-tabs.tsx, healio/lib/query-keys.ts, healio/tsconfig.tsbuildinfo.</item>
                <item>Typecheck: `npm run typecheck` passed after wiring the documents tab and after tab header copy/status polish.</item>
                <item>API regression/route tests: `node --import tsx --test tests/unit/patient-documents-route.test.ts` passed.</item>
                <item>Chrome DevTools MCP verification on `http://localhost:4012/patients/pat_0d410ad9-12f0-47ae-97a4-cb205177f559`: opened the Documents tab and confirmed the educational empty state (`No documents yet`) plus in-context Upload CTA.</item>
                <item>Chrome DevTools MCP upload flow: opened `Upload Patient Document` drawer, uploaded `/tmp/healio-mcp-fixtures/test-lab.pdf` via file input, submitted successfully, observed success toast, and verified the new document card rendered in the list.</item>
                <item>Chrome DevTools MCP preview flow: opened `Document Preview` modal from the list card, verified metadata, and confirmed local-mode fallback preview messaging for `memory://signed/...` URLs with an `Open Link` action (future Supabase-signed HTTP URLs can inline preview).</item>
                <item>Chrome DevTools MCP interaction checks: `Escape` closes the preview modal; drawer/modal remain in-context without navigating away from the patient chart.</item>
                <item>Chrome DevTools MCP responsive check: resized to mobile `390x844` and back to desktop `1280x900`; Documents tab list/actions remained usable and mobile bottom navigation stayed visible.</item>
                <item>Chrome DevTools MCP network checks (expected): GET `/api/v1/patients/:id` = 200; GET `/api/v1/patients/:id/documents` = 200; POST `/api/v1/patients/:id/documents` = 201; refetch GET `/api/v1/patients/:id/documents` = 200.</item>
                <item>Chrome DevTools MCP console check: only expected React DevTools informational message; no application errors during documents tab verification.</item>
                <item>Implementation commit: 0569c22 (feat(healio-patients): patient documents tab ui).</item>
            </evidence>
            <completion_signal>Task is done only when state=DONE, is_done=true, completed_at is filled, verification_status=PASSED, and evidence records changed files/tests/screenshots as applicable.</completion_signal>
        </execution_tracking>
        <references>
            <agent_to_execute>Full-Stack Next.js Engineer</agent_to_execute>
            <estimated_complexity>medium</estimated_complexity>
            <blocks_on>HEALIO-006, HEALIO-037, HEALIO-039</blocks_on>
            <task_slug>PATIENT_DOCUMENTS_TAB_UI</task_slug>
        <verification_tool>Chrome DevTools MCP (required for frontend task verification)</verification_tool><verification_rules_ref>healio/.status/FRONTEND_VERIFICATION_RULES.xml</verification_rules_ref></references>
    </task_package>
</task_packages>
